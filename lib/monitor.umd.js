!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).monitor=n()}(this,function(){"use strict";const t=window.requestIdleCallback||window.requestAnimationFrame||(e=>setTimeout(e,17));function l(){return window.location.href}let i=[];let o={},r=void 0;function v(e,n=!1){n?c("",{baseInfo:o,eventInfo:[e]}):(i.push(e),clearTimeout(r),5<=i.length?a():r=window.setTimeout(a,5e3))}function a(){if(i.length){const n=i.slice(0,5);i=i.slice(5);var e=Date.now();c("",{...o,sendTime:e,data:n.map(e=>e)}),i.length&&t(a)}}const c=(e,n)=>{console.log(e,"--------------url"),console.log(n,"--------------data")};window.addEventListener("beforeunload",()=>{a()});function u(e,n){return{name:e,value:void 0===n?-1:n,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function f(e,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var t=new PerformanceObserver(function(e){return e.getEntries().map(n)});return t.observe({type:e,buffered:!0}),t}}catch(e){}}function p(n,t){function i(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(n(e),t&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))}addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)}function m(n){addEventListener("pageshow",function(e){e.persisted&&n(e)},!0)}function d(n,t,i){var o;return function(e){0<=t.value&&(e||i)&&(t.delta=t.value-(o||0),!t.delta&&void 0!==o||(o=t.value,n(t)))}}function e(){return"hidden"===document.visibilityState?0:1/0}function n(){p(function(e){e=e.timeStamp;k=e},!0)}function s(){return k<0&&(k=e(),n(),m(function(){setTimeout(function(){k=e(),n()},0)})),{get firstHiddenTime(){return k}}}function g(n,t){function e(e){"first-contentful-paint"===e.name&&(c&&c.disconnect(),e.startTime<o.firstHiddenTime&&(r.value=e.startTime,r.entries.push(e),i(!0)))}var i,o=s(),r=u("FCP"),a=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],c=a?null:f("paint",e);(a||c)&&(i=d(n,r,t),a&&e(a),m(function(e){r=u("FCP"),i=d(n,r,t),requestAnimationFrame(function(){requestAnimationFrame(function(){r.value=performance.now()-e.timeStamp,i(!0)})})}))}function y(n,e){function t(e){-1<D&&n(e)}function i(e){var n,t;e.hadRecentInput||(n=c[0],t=c[c.length-1],a&&e.startTime-t.startTime<1e3&&e.startTime-n.startTime<5e3?(a+=e.value,c.push(e)):(a=e.value,c=[e]),a>r.value&&(r.value=a,r.entries=c,o()))}C||(g(function(e){D=e.value}),C=!0);var o,r=u("CLS",0),a=0,c=[],s=f("layout-shift",i);s&&(o=d(t,r,e),p(function(){s.takeRecords().map(i),o(!0)}),m(function(){D=-1,r=u("CLS",a=0),o=d(t,r,e)}))}function T(e,n){b||(b=n,S=e,P=new Date,E(removeEventListener),w())}function w(){var n;0<=S&&S<P-q&&(n={entryType:"first-input",name:b.type,target:b.target,cancelable:b.cancelable,startTime:b.timeStamp,processingStart:b.timeStamp+S},F.forEach(function(e){e(n)}),F=[])}function E(n){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return n(e,B,R)})}function h(e,n){function t(e){e.startTime<i.firstHiddenTime&&(o.value=e.processingStart-e.startTime,o.entries.push(e),a(!0))}var i=s(),o=u("FID"),r=f("first-input",t),a=d(e,o,n);r&&p(function(){r.takeRecords().map(t),r.disconnect()},!0),r&&m(function(){o=u("FID"),a=d(e,o,n),F=[],S=-1,b=null,E(addEventListener),F.push(t),w()})}function L(n,t){function e(e){var n=e.startTime;n<r.firstHiddenTime&&(a.value=n,a.entries.push(e),i())}var i,o,r=s(),a=u("LCP"),c=f("largest-contentful-paint",e);c&&(i=d(n,a,t),o=function(){I[a.id]||(c.takeRecords().map(e),c.disconnect(),I[a.id]=!0,i(!0))},["keydown","click"].forEach(function(e){addEventListener(e,o,{once:!0,capture:!0})}),p(o,!0),m(function(e){a=u("LCP"),i=d(n,a,t),requestAnimationFrame(function(){requestAnimationFrame(function(){a.value=performance.now()-e.timeStamp,I[a.id]=!0,i(!0)})})}))}var b,S,P,F,k=-1,C=!1,D=-1,R={passive:!0,capture:!0},q=new Date,B=function(e){var n,t,i,o;function r(){T(t,i),o()}function a(){o()}e.cancelable&&(n=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(t=n,i=e,o=function(){removeEventListener("pointerup",r,R),removeEventListener("pointercancel",a,R)},addEventListener("pointerup",r,R),addEventListener("pointercancel",a,R)):T(n,e))},I={};function O(e){console.log(e),console.log("init"),console.log({}),A(),M(),U(),H(),x(),z()}const N={performance:!!window.performance,getEntriesByType:!(!window.performance||!performance.getEntriesByType),PerformanceObserver:"PerformanceObserver"in window,MutationObserver:"MutationObserver"in window,PerformanceNavigationTiming:"PerformanceNavigationTiming"in window},A=function(){let e=performance.timing;const n={};N.getEntriesByType&&((t=performance.getEntriesByType("paint")).length&&(n.FMP=t[t.length-1].startTime),N.PerformanceNavigationTiming&&(t=performance.getEntriesByType("navigation")[0])&&(e=t));var{domainLookupStart:t,domainLookupEnd:i,connectStart:o,connectEnd:r,secureConnectionStart:a,requestStart:c,responseStart:s,responseEnd:u,domInteractive:f,domContentLoadedEventEnd:p,loadEventStart:m,fetchStart:d}=e;console.log(e,"----------------t"),n.FP=u-d,n.TTI=f-d,n.DomReady=p-d,n.Load=m-d,n.FirseByte=s-t,n.DNS=i-t,n.TCP=r-o,n.SSL=a?r-a:0,n.TTFB=s-c,n.Trans=u-s,n.DomParse=f-u,n.Res=m-p,v({...n,type:"performance",pageURL:l()})},M=function(){g(function(e){v({...e,pageURL:l(),subType:"fcp",type:"performance"})})},U=function(){L(function(e){v({...e,pageURL:l(),subType:"lcp",type:"performance"})})},H=function(){h(function(e){v({...e,pageURL:l(),subType:"fid",type:"performance"})})},x=function(){y(function(e){v({...e,pageURL:l(),subType:"cls",type:"performance"})})},z=function(){const l=[];const e=new PerformanceObserver(function(e){for(const d of e.getEntries()){var{name:n,transferSize:t,initiatorType:i,startTime:o,responseEnd:r,domainLookupEnd:a,domainLookupStart:c,connectStart:s,connectEnd:u,secureConnectionStart:f,responseStart:p,requestStart:m}=d;l.push({name:n,transferSize:t,initiatorType:i,startTime:o,responseEnd:r,dnsLookup:a-c,initialConnect:u-s,ssl:u-f,request:p-m,ttfb:p-m,contentDownload:p-m})}});e.observe({entryTypes:["resource"]});window.addEventListener("pageshow",()=>{e&&e.disconnect(),v({resourceList:l,subType:"resource",type:"performance"})},{once:!0,capture:!0})};return{init:O,install:function(e,n){O(n),e.prototype?e.prototype.$monitor={}:e.config.globalProperties.$monitor={}}}});
