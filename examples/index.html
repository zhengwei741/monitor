<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    #app{
      height: 500px;
      width: 100%;
    }
  </style>
  <body>
    <!-- <img src="https://img0.baidu.com/it/u=3798217922,3880088897&fm=253&fmt=auto&app=120&f=JPEG?w=889&h=500"> -->
    <div id="app"></div>
  </body>
  <!-- <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.7.0-beta.2/vue.min.js"></script>
  <script src="../lib/monitor.umd.js"></script> -->
  <!-- <script src="../lib/monitor-web.umd.js"></script> -->
  <script>
    window.addEventListener('error', (e) => {
      console.log(e)
    }, true)

    const throttle = (fn, delay) => {
      let canRun = true
      return function (...args) {
        if (!canRun) return
        // @ts-ignore
        fn.apply(this, args)
        canRun = false
        setTimeout(() => {
          canRun = true
        }, delay)
      }
    }

    ['click'].forEach((eventType) => {
      const _handler = throttle(function(_e) {
        let target = _e.target
        if (!target) return
        console.log(eventType, target)
      }, 1000)
      window.document.addEventListener(eventType, _handler)
    })

    // new monitorWeb({
    //   url: 'url',
    //   appId: 'appId',
    //   userId: 'userId'
    // })

    // setTimeout(() => {
    //   fetch('http://www.baidu.com')
    // }, 1000)
    // window.addEventListener('unhandledrejection', (e) => {
    //   console.log(e)
    //   console.log('addEventListener')
    // })
    // window.onunhandledrejection = function(e) {
    //   console.log(e)
    //   console.log('onunhandledrejection')
    // }
    // new Promise(() => {
    //   throw new Error('123')
    // })
    // 能触发 unhandledrejection ，因为未显式处理
    // Promise.reject('test').then()

    // 能触发 unhandledrejection ，因为未显式处理
    // Promise.reject('test').then(console.log)

    // 不能触发 unhandledrejection ，因为已处理
    // Promise.reject('test').then(console.log, console.log)

    // 不能触发 unhandledrejection ，因为没处理，直接抛出异常 ??
    // 实测可以触发
    // Promise.reject('test')
    // new Promise(() => {
    //   throw new Error('ee')
    // }).then(() => {})
    // window.onerror = function(e) {
    //   console.log(arguments, 'onerror')
    // }
    // window.addEventListener('error', function() {
    //   console.log(arguments, 'addEventListener')
    // }, true)
    // console.log(as)
    // console.log(asd)
    // monitor.init({
    //   error: {
    //     resource: true,
    //     promise: true,
    //     js: true,
    //     vue: Vue
    //   }
    // });
    // Vue.config.errorHandler = function(error, vm, lifecycleHook) {
    //   console.log(error)
    //   console.log(vm)
    //   console.log(lifecycleHook)
    // }
    // const app = new Vue({
    //   el: '#app',
    //   data() {
    //     return {
    //       app: 'appp'
    //     }
    //   },
    //   template: `<div>{{ app }}</div>`,
    //   created() {
    //     // setTimeout(() => {
    //     //   console.log(asd)
    //     // }, 100)
    //     // window.ss()
    //     // throw new Error('xxx')
    //     // this.in()
    //   },
    //   methods: {
    //     in() {
    //       if (window.Promise) {
    //         return new Promise((resolve) => {
    //           // 一段耗时的异步操作
    //           // eee.eew();
    //           // resolve('成功'); // 数据处理完成
    //           throw new Error('custom');
    //         }).then(
    //           (res) => { console.log(res); }, // 成功
    //         );
    //       }
    //     }
    //   }
    // })

    // setTimeout(() => {
    //   new Promise(() => {
    //     throw new Error('Promise error')
    //   })
    // }, 100)
    // window.onload = function () {
    //   console.log(monitor);
    // };
    // console.log(webtracing);
    // webtracing.init({
    //   requestUrl: "http://172.15.224.10:33199/trackweb/tra",
    //   appName: "chengxh",
    //   event: true,
    // });
  </script>
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.8.0-beta.2/vue.min.js"></script>
  <!-- <script src="monitor.umd.js"></script> -->
  <!-- <script src="http://localhost:8080/static/js/54.js"></script> -->
</html>
