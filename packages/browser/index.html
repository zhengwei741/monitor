<html>
  <!-- <script src="./dist/browser.umd.js"></script> -->

  <script>
    const instrumentType = {
      DC: "_dom_click",
    };
    const throttle = (fn, delay) => {
      let canRun = true;
      return function (...args) {
        if (!canRun) return;
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        fn.apply(this, args);
        canRun = false;
        setTimeout(() => {
          canRun = true;
        }, delay);
      };
    };
    const handlers = {};
    function addEventHandler(type, handler) {
      handlers[type] = handlers[type] || [];
      if (typeof handler !== "function") {
        return false;
      }
      if (handlers[type].findIndex(handler) !== -1) {
        return false;
      }
      handlers[type].push(handler);
      return true;
    }
    function triggerHandlers(type, data) {
      if (!type || !handlers[type]) {
        return;
      }
      for (const handler of handlers[type] || []) {
        try {
          handler(data);
        } catch (e) {
          console.log(`Type:${type}\nName:${getFunctionName(handler)}\n错误`);
        }
      }
    }
    const fallbackGlobalObject = {};
    function getGlobalObject() {
      return typeof window !== "undefined"
        ? window
        : typeof self !== "undefined"
        ? self
        : fallbackGlobalObject;
    }
    function proxyDomClick(handler) {
      const _global = getGlobalObject();
      if (!("document" in _global)) {
        return;
      }
      const res = addEventHandler(instrumentType.DC, handler);
      if (!res) {
        return;
      }
      const globalDOMEventHandler = throttle(function (e) {
        // let target = e.target || e.srcElement
        // if (!target) return
        triggerHandlers(instrumentType.DC, e);
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
      }, 1000);
      _global.addEventListener("click", globalDOMEventHandler);
    }

    proxyDomClick(() => {
      console.log(123);
    });

    const addDiv = () => {
      const div = document.createElement("div");
      div.style.width = "100px";
      div.style.height = "100px";
      div.innerText = "xxxx";
      document.body.append(div);
      return div;
    };

    setTimeout(() => {
      const div = addDiv();
      const click = new MouseEvent("click");
      setTimeout(() => {
        debugger;
        div.dispatchEvent(click);
      }, 1000);
    }, 1000);
  </script>
</html>
